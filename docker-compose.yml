# docker-compose.yml (BASE)
# Bu dosya, servisin ortak yapılandırmasını içerir ve tek başına çalıştırılamaz.
# CPU veya GPU profili ile birleştirilmelidir.
networks:
  sentiric-net:
    name: "${NETWORK_NAME:-sentiric.cloud}"
    driver: bridge
    ipam:
      config:
        - subnet: ${NETWORK_SUBNET:-10.88.0.0/16}
          gateway: ${NETWORK_GATEWAY:-10.88.0.1}

volumes:
  
  # =============================================================
  # KATMAN 1: TEMEL ALTYAPI (INFRASTRUCTURE)
  # Platformun temel yapı taşları.
  # =============================================================

  #  [capability-llm]: Büyük Dil Modeli Yetenekleri (LLM Capabilities)
  # --------------------------------------------------    
  llm-llama-models:
  llm-llama-cache:  

services:
  llm-llama-service:

    volumes:
      - ../sentiric-certificates:/sentiric-certificates:ro
      - llm-llama-models:/models
    ports:
      - "${LLM_LLAMA_SERVICE_HTTP_PORT:-16070}:${LLM_LLAMA_SERVICE_HTTP_PORT:-16070}"
      - "${LLM_LLAMA_SERVICE_GRPC_PORT:-16071}:${LLM_LLAMA_SERVICE_GRPC_PORT:-16071}"
      - "${LLM_LLAMA_SERVICE_METRICS_PORT:-16072}:${LLM_LLAMA_SERVICE_METRICS_PORT:-16072}"
    networks:
      sentiric-net:
        ipv4_address: ${LLM_LLAMA_SERVICE_IPV4_ADDRESS:-10.88.60.7}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${LLM_LLAMA_SERVICE_HTTP_PORT:-16070}/health"]
      interval: 30s
      timeout: 10s
      retries: 10
      start_period: 60m