# docker-compose.gpu.yml
# Üretim ortamında GPU imajını çekmek ve GPU kaynaklarını ayırmak için kullanılır.
# Kullanım: docker compose -f docker-compose.yml -f docker-compose.gpu.yml up -d
x-gpu-resources: &gpu-resources
  deploy:
    resources:
      reservations:
        devices:
          - driver: nvidia
            count: 1
            capabilities: [gpu]

services:
  llm-llama-service:
    image: ghcr.io/sentiric/sentiric-llm-llama-service:latest-gpu
    environment:
      - LLM_LLAMA_SERVICE_GPU_LAYERS=${LLM_LLAMA_SERVICE_GPU_LAYERS:-28}
      - NVIDIA_VISIBLE_DEVICES=all
    # GPU kaynaklarını referans göster
    <<: *gpu-resources