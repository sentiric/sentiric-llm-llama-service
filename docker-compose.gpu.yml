# docker-compose.gpu.yml
# Üretim ortamında GPU imajını çekmek ve GPU kaynaklarını ayırmak için kullanılır.

# x- (uzantı) alanları, YAML çapaları gibi davranarak kod tekrarını önler.
x-gpu-resources: &gpu-resources
  deploy:
    resources:
      reservations:
        devices:
          - driver: nvidia
            count: 1
            capabilities: [gpu]

services:
  llm-llama-service:
    image: ghcr.io/sentiric/sentiric-llm-llama-service:latest-gpu
    environment:
      - LLM_LLAMA_SERVICE_GPU_LAYERS=${LLM_LLAMA_SERVICE_GPU_LAYERS:-64}
      # YENİ EKLENDİ: Konteynerin GPU'yu görmesini garanti eder.
      - NVIDIA_VISIBLE_DEVICES=all
    # GPU kaynaklarını referans göster
    <<: *gpu-resources